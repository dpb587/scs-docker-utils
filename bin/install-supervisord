#!/bin/bash

set -e

apt-get install -y python-setuptools
easy_install supervisor
mkdir -p /var/{log,run}/supervisord
mkdir -p /etc/supervisord.d
cat > /etc/supervisor.conf <<EOF
[supervisord]
directory = /
logfile = /var/log/supervisord/supervisord.log
nodaemon = true
pidfile = /var/run/supervisord/supervisord.pid
[include]
files = /etc/supervisord.d/*.conf
[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface
[unix_http_server]
file = /var/run/supervisord/supervisord.sock
[supervisorctl]
serverurl=unix:///var/run/supervisord/supervisord.sock
EOF
cat > /etc/init/supervisor.conf <<EOF
description "supervisor"
start on runlevel [2345]
stop on runlevel [!2345]
respawn
exec /usr/local/bin/supervisord -c /etc/supervisor.conf
EOF
service supervisor start

